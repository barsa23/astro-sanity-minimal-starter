---
// Component Imports
import BlogPostLayout from '../../layouts/BlogPostLayout.astro'
import BlogPost from '../../components/BlogPost.astro'

import { sanityGraphqlQuery } from '../../utils/helpers.js';
import { allPosts } from '../../lib/api.js';

// Component Script:
// You can write any JavaScript/TypeScript that you'd like here.
// It will run during the build, but never in the browser.
// All variables are available to use in the HTML template below.
// let title = 'Example Blog';
// let description = 'This is a starter repo for an blog built with Astro including open graph tags, canonical urls, RSS, sitemap support.';
// let permalink = 'https://example.com/blog/';

export async function getStaticPaths({paginate}) {
  const response = await fetch(sanityGraphqlQuery(allPosts));
  const data = await response.json();
  const allBlogPosts = data.data.allPost;

  return allBlogPosts.map(post => ({params: { slug: post.slug.current }, props: {post}}));
}

const { post } = Astro.props;
---
<!DOCTYPE html>
<BlogPostLayout title={post.title} ogImageUrl={post.mainImage.asset.url} >
   <BlogPost post={post} />
</BlogPostLayout>